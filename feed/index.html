<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mahlzeit!</title>
    <link href="assets/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD">
  </head>
  <body>

  <main>
  <div class="px-4 py-5 my-5 text-center">
    <div class="d-block mx-auto mb-4"><img src="assets/1F35D.svg" height="130em;" title="designed by OpenMoji â€“ the open-source emoji and icon project. License: CC BY-SA 4.0"></div>
    <h1 id="headline" class="display-5 fw-bold">Mahlzeit!</h1>
    <div id="today" class="col-lg-6 mx-auto">
      <p class="lead mb-4 mz-dish">ðŸ˜­</p>
    </div>
  </div>
  </main>
  <script src="assets/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"></script>
  <script src="assets/xdate.min.js"></script>
  <script src="assets/jquery-3.6.3.min.js"></script>
  <script type="text/javascript">
    class MenuPlan {
      static #dayNames = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
      date = new XDate();
      #data;

      constructor(data) {
        this.#data = data;
      }

      getMenu() {
        return Object.values(this.#data[this.weekString()][this.weekDay()]);
      }

      weekDay() {
        return MenuPlan.#dayNames[this.date.getDay()];
      }
      
      weekString() {
        return this.date.toString("yyyy'W'ww");
      }

      [Symbol.iterator]() {
        return { next: () => ( { value: this.getMenu(), done: (this.date.addDays(1).getDay() > 5) }) };
      };
    }

    $(document).ready(function(){
      $.getJSON( "mahlzeit.json", function( data ) {
        const menu = new MenuPlan(data);
        var p = $( "#today .mz-dish" );
        var today = menu.getMenu();

        $( "#headline").text(menu.weekDay());

        if ( today.length > 0 ) {
            p.remove();
        }

        today.forEach( function( val ) {
            p.clone().text(val).appendTo("#today");
        });

        for (const value of menu) {
          console.log(value);
        }
      }).fail(function(){
        $( "#headline").text("Oops! Could not load the menu!");
      });
    });
  </script>
  </body>
</html>
